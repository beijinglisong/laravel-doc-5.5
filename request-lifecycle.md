# 请求生命周期

> 作者：[韩忠康](http://hellokang.net)。校对：南宁宁

---

[TOC]

## # 引言
在实际生活中使用工具时，如理解工具的原理，那么使用时也就会得心应手。 应用开发亦是如此。 如你理解了开发工具的结构和原理，开发时就会轻松加愉快。

本文档的目标就是让你对Laravel框架有个宏观的认识。 随着对框架越来越全面的认识，一切都不会再那么神秘， 同时我们在构建应用时也会越来越有信心。  切记，在不能马上理解那些全部的专业术语时，不要灰心。 试着先了解些基础功能，随着你对文档的探索逐步深入，你的知识也会随之增长。

## # 生命周期概述

### ## 首要任务
Laravel应用的全部请求入口都是`public/index.php`文件。所有的请求应该被你的web服务器（Apache/Nginx）定位到该文件。`index.php`文件不会包含大量的代码，而仅仅是加载框架其余部分的一个起始点。

`index.php`文件会加载由Compser生成的自动加载，之后会从`bootstrap/app.php`中获取一个Laravel应用的实例。Laravel框架做的第一件事就是创建一个应用实例（也称作[服务容器](container)）。

### ## HTTP/Console内核
接下来，依据进入应用的请求类型不同，请求将会被发送到HTTP或Console内核。这两个内核提供的服务是请求流程处理的核心。现在，让我们把注意力放在HTTP内核上，HTTP内核由`app/Http/Kernel.php`定义。

HTTP内核继承自`Illuinate\Foundation\Http\Kernel`类, 该类定义了一个`bootstrapers(启动项)`数组, 会在请求处理前被执行。这些启动项包括配置错误处理器，配置日志，[探测应用环境]()，以及哪些需要在正式处理请求前执行的任务。

HTTP内核还定义了一些所有请求在被应用处理前执行的HTTP`中间件`。这些中间件用来处理 [Http Session]() 的读写，探测应用是否处于维护模式，[验证CSRF令牌]()，等等。

HTTP内核的`handle`方法的典型功能相当简单：接受一个`Request请求`同时返回一个`Response响应`。可以把内核想象成一个代表整个应用的大黑盒子，给他HTTP请求，他会返回HTTP响应。

### ## 服务提供者
内核启动过程中最重要的事项之一是加载应用的[服务提供者]()。应用全部的服务器提供者由配置文件`config/app.php`中的`providers`配置项进行配置。首先每个服务提供者的`register`方被调用，然后，当全部的服务提供者注册完毕后，他们的`boot`方法会被调用。

服务提供者负责启动框架的各种组件，例如数据库，队列，验证，和路由。这些服务器提供者启动和配置了框架中的各种功能，因此他们是Laravel是引导过程中最重要的方面。

### ## 分发请求
一旦应用引导完毕同时全部的服务提供者注册完毕，`request请求`会被传递到路由器进行分发。路由器会将请求分发到某个路由或控制器来处理，同时还会运行某个路由特定的中间件程序。


## # 聚焦服务提供者
服务提供者是Laravel应用引导过程中的核心部分。应用实例创建完毕，服务提供者注册完毕，同时请求交由启动的应用来处理。一切就是这么简单！

牢固掌握Laravel应用是如何构建以及如何通过服务提供者完成引导是很有必要的。同时留意，你应用的默认服务提供者被定义在`app/Providoers`目录中。

默认情况下，`AppServiceProvider`是空的。这个服务提供者是自定义应用启动项和服务容器绑定的好位置。当然对于大型应用来说，可以定义多个服务提供者，来完成更细致的启动任务。

